# Vulnerability Management and Remediation with Nessus

<img src="https://i.imgur.com/288d1oQ.png"/>

In this lab, we are going to be using Nessus, a vulnerability scanner, on a virtual machine (VM) with deprecated software to identify vulnerabilities. We will then be remediating a select number of these vulnerabilities that Nessus identifies. We will also be comparing vulnerability scans before deprecated software has been installed, after it has been installed, and after remediations have taken place. 

<p>Resources Used in Lab:

- VMware Workstation Player
- VM
- Windows 10
- Firefox
- Nessus Vulnerability Scanner</p>

<p>This lab will consist of 7 steps:
   
1. Install the VMware Player
2. Download Windows 10 ISO file
3. Download & Install Nessus
4. Set up VM
5. Testing a Nessus Vulnerability Scan
6. Perform a Credentialed Scan
7. Performing a Credentialed Scan with Deprecated Software</p>




<p>1. Install VMware Player

- Head to Download VMware Workstation Player and download the Windows version of the workstation player
- This will allow us to launch a VM</p>

<img src="https://i.imgur.com/vzNHH42.png"/>

2. Download Windows 10 ISO
   
- Head to https://www.microsoft.com/en-us/software-download/windows10 and scroll down to the header “Create Windows 10 installation media”, then download Windows 10 ISO via the “download tool now” button. This is essentially a file that will allow us to download Windows 10 on our virtual machine. After the download, open the file to get to the Windows 10 Setup
  
<img src="https://i.imgur.com/tnYSf9Z.png"/>

- At the beginning of the setup, you will be prompted with “What do you want to do?”. Select the option “Create installation media (USB flash drive, DVD, or ISO file) for another PC”. This will allow us to obtain the ISO file needed for the virtual machine. 
- After selecting Next a couple more times, select “ISO file” under the “Choose which media to use” section. Create or select a folder to remember where the ISO file will be located.

<img src="https://i.imgur.com/R0ZOKS3.png"/>

3. Download Nessus
   
- Head to https://www.tenable.com/products/nessus/nessus-essentials and register for Nessus Essentials. You will then receive an email with the ability to download Nessus and with a registration key/activation code. Download Nessus - 10.7.2 & Platform Windows - x86_64.
  
<img src="https://i.imgur.com/xDcHkPE.png"/>

- Launch Nessus once the download is complete to finish the installation. Once the installation is complete, save the URL that is automatically opened once the installation is complete.
- When the webpage opens, select “Connect via SSL”. After it is done initializing, select Nessus Essentials. Skip the next step as you should already have an activation code in your email. After this, create account credentials that you will remember.
  
<img src="https://i.imgur.com/0WAvs1x.png"/>

4. Setting up a Virtual Machine
  
- Launch VMware Workstation 17 Player, and go to Player > File > New Virtual Machine. Select browse to navigate to the folder that contains the ISO file that was installed earlier and select it, then select Open.
  
<img src="https://i.imgur.com/OjXkodx.png"/>

- After selecting the Next button a few times, select Customize Hardware when the option appears. Select the Network Adapter and change the network connection to Bridged. We want this option selected because it will allow the VM to be on the same network as the physical machine you are using, which will allow Nessus to communicate with the VM more easily.

<img src="https://i.imgur.com/TnOcePT.png"/>

- Select Finish. The VM will automatically launch after this. When the prompt appears, select Install now > I don’t have a product key > Windows 10 Pro > Next > Custom: Install Windows only (advanced) > Next > Offline account. Create a username and password for the admin account.
5. Testing a Vulnerability Scan with Nessus
  
- We are now going to perform a vulnerability scan for the purpose of seeing if there is a proper connection between Nessus and the VM. Ping the IP address of the VM from your physical machine to ensure connectivity. If the request times out, go to wf.msc from the VM and then select Windows Defender Firewall Properties > Firewall state Off (all three profiles). We are only doing this because, for one, this is a virtual machine so there is no important data on it for bad actors to grab. And two, we are disabling the firewall so that our ICMP requests will go through and ensure there is a connection. 
- Go to Nessus Essentials and select New scan > Basic Network Scan
- Give the scan a name and paste the IP address of the VM into the Targets text box
- Select Save > Launch
  
<img src="https://i.imgur.com/YXbsbeu.png"/>

- Note that this scan is a non-credentialed scan, meaning that Nessus will not be able to detect any vulnerabilities that could be exploited by a bad actor if they were able to log in to the VM. We are only performing this scan to verify its connectivity.
- After the scan is completed, click on the scan, and then the Vulnerabilities option to see all of the output. You can select each vulnerability to gather more information about it and steps to remediate them. Note that for a non-credentialed scan, you will most likely receive a lot of Info outputs, which isn’t technically a vulnerability, but rather information that makes you aware of a certain topic.

<img src="https://i.imgur.com/ksrvjek.png"/>

- Now that the vulnerability scan has been successful, we will perform a credentialed scan so that Nessus can detect any vulnerabilities that could be exploited by an actor who has the correct username and password to the VM.
- 
6. Perform a Credentialed Scan on the VM
  
- Go to your VM and go to Services via the search box
- Scroll down & right-click on Remote Registry and select Startup type > Automatic > Service status Start
- Enabling the remote registry will allow Nessus to connect to the VM’s registry to scan for any insecure configurations
- If it is not already on, go to Advanced Sharing Settings > File and printer sharing > Turn on file and printer sharing > Save changes
- Go to User Account Control Settings and move the bar to Never notify (this is so that notifications do not constantly appear during the credential scan)
- Go to the Registry Editor and add a key that will allow the remote account to connect in. Once opened go to HKEY_LOCAL_MACHINE > SOFTWARE > Microsoft > Windows > CurrentVersion > Policies > System. Create a new DWORD (32-bit) Value and name it LocalAccountTokenFilterPolicy, then set the value to 1.
  
<img src="https://i.imgur.com/1x13V3o.png"/>

- Restart the VM and log back in
- Go back to Nessus Essentials and click on the checkbox > more > configure next to the scan that we created before to edit it
- On the Credentials section, add the Windows credentials that we created at the beginning of setting up the OS for the VM

<img src="https://i.imgur.com/8DaBa4q.png"/>

- Select Save & launch the scan again
- Once complete, click on the scan to view the results.
  
<img src="https://i.imgur.com/0mihFOm.png"/>

- Note how more vulnerabilities are of higher severity than the non-credentialed scan, which was mostly info outputs. You can compare the two via the History section. The Remediations section can give you a summary of how to remediate all of the vulnerabilities that were identified.

<img src="https://i.imgur.com/4oRUdPB.png"/>

7. Performing a Credentialed Scan with Deprecated Software
   
- For this lab, we will install an old, deprecated version of Firefox on our VM, so that Nessus can detect the vulnerabilities that come with deprecated software and so that we can practice remediating vulnerabilities ourselves (You may try this on any deprecated software, it does not have to be Firefox). We will also be able to compare the scan after we install the deprecated software to the scan after we remediate the vulnerabilities.
- Head to https://ftp.mozilla.org/pub/firefox/releases/3.6.12/win32/en-US/ and download Firefox Setup 3.6.12.exe on the VM
- Note that this version of Firefox was released in 2010, and support for this version ended in 2012
- Finish the installation of Firefox
- Go back to Nessus Essentials and launch the credentialed scan again
- Once the scan is complete, go to the Vulnerabilities section and note how there are a lot more critical vulnerabilities compared to the last scan, and that Mozilla Firefox has a high number of identified vulnerabilities

 
<img src="https://i.imgur.com/hx6bFIF.png"/>

- Go to the Remediations section, in which Nessus recommends we upgrade Mozilla Firefox to resolve the vulnerabilities, along with additional actions for other vulnerabilities 

<img src="https://i.imgur.com/U4gJm36.png"/>

- In addition to upgrading Firefox, we can also choose to uninstall the software to remediate the vulnerabilities. To do so, go to Programs and Features via the Windows search box, select Uninstall or change a program, and then select Firefox to uninstall.
- We can also see if there are any Windows Updates available, which could remediate many other identified vulnerabilities from the scan. Go to the Windows Update section in Settings, and continue to download updates until there are no more available on the VM.
- After this is complete, launch the Nessus scan one more time. Note that the number of critical/high vulnerabilities has been significantly reduced.
<img src="https://i.imgur.com/7rxPEy0.png"/>

